{% extends 'base.html.twig' %}

{% block listeCateggFront %}

 {{ parent() }}
 {% endblock %}


{% block stylesheets %}
    {{ parent() }}

    <style>
        .product-container {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
            max-width: 600px; 
            margin: 0 auto; 
        }
        .product-image {
            max-width: 50%;
        }
        .details-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start; 
            justify-content: center; 
            margin-left: 20px; 
        }
        .product-price {
            font-weight: bold;
        }
        .add-to-cart,
        .continue-shopping {
            margin-top: 10px; 
            width: 100%;
            text-align: center;
        }
        .add-to-cart {
            background-color: #ff69b4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
        }
        .add-to-cart:hover {
            background-color: #ff3385;
        }
        .continue-shopping {
            background-color: transparent;
            color: #333; 
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            text-decoration: underline;
        }
        .continue-shopping:hover {
            background-color: transparent;
        }
          .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #ff69b4;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-left: 10px; 
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .reviews {
			color: #f9d71c;
		}

    </style>
{% endblock %}

{% block AabiElWest1 %}
<div class="fashion_section">
{% for message in app.flashes('success') %}
    <div class="alert alert-success" role="alert">
        {{ message }}
    </div>
 {% endfor %}
 {% for message in app.flashes('fail') %}
    <div class="alert alert-danger" role="alert">
        {{ message }}
    </div>
{% endfor %}

<div class="background-colour">
<div class="wrapper">
<h1>  </h1>
<h1>  </h1>
<h1>  </h1>
<div class="product-container">


    <img class="product-image" src="{{ asset('uploadsProduit/' ~ product.ImageP) }}" alt="Image du produit">
    <div class="details-container">
      <h2 class="product-title">{{ product.NomP }} "</h2>
      <p class="product-price">Prix : {{ product.PrixP }} DT</p>
      <input type="number" min="1" value="1" id="quantity" style = "width :100%;">
      <div class="reviews">
							<script src="https://kit.fontawesome.com/c8e4d183c2.js" crossorigin="anonymous"></script>

							{% if moyenne == "0" %}
								<i class="far fa-star"></i>
								<i class="far fa-star"></i>
								<i class="far fa-star"></i>
								<i class="far fa-star"></i>
								<i class="far fa-star"></i>
							{% elseif moyenne == "1" %}
								<i class="fas fa-star"></i>
								<i class="far fa-star"></i>
								<i class="far fa-star"></i>
								<i class="far fa-star"></i>
								<i class="far fa-star"></i>
							{% elseif moyenne == "2" %}
								<i class="fas fa-star"></i>
								<i class="fas fa-star"></i>
								<i class="far fa-star"></i>
								<i class="far fa-star"></i>
								<i class="far fa-star"></i>
							{% elseif moyenne == "3" %}
								<i class="fas fa-star"></i>
								<i class="fas fa-star"></i>
								<i class="fas fa-star"></i>
								<i class="far fa-star"></i>
								<i class="far fa-star"></i>
							{% elseif moyenne == "4" %}
								<i class="fas fa-star"></i>
								<i class="fas fa-star"></i>
								<i class="fas fa-star"></i>
								<i class="fas fa-star"></i>
								<i class="far fa-star"></i>
							{% elseif moyenne == "5" %}
								<i class="fas fa-star"></i>
								<i class="fas fa-star"></i>
								<i class="fas fa-star"></i>
								<i class="fas fa-star"></i>
								<i class="fas fa-star"></i>
							{% endif %}

						</div>
						<a href="{{ path('app_consulterAvisFront', {'id_p': product.Id_Produit}) }}">{{nb}}
							évaluations</a>
      <form>

      <button id="add-to-cart-button" class="add-to-cart" data-toggle="modal" data-target = "#SucceesAddToPanier">Ajouter au panier</button>
      </from>
      <div class="spinner"></div>
      <a href="{{ path('showProduitFront') }}"class ="continue-shopping btn btn-primary"><i class ="fa fa-arrow-left"></i> Continuer mes achats </a> 
    </div>
</div>
</div>
</div>
  <div class="modal fade" id="SucceesAddToPanier" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true"> -->
   

    
</div>
<script>
    // Récupération du bouton "Ajouter au panier"
    var addToCartButton = document.getElementById('add-to-cart-button');

    // Ajout d'un écouteur d'événement sur le clic du bouton
    addToCartButton.addEventListener('click', function() {
        // ... votre code existant ...

        // Ajoutez la classe "added-to-cart" à la modale
        var modal = document.getElementById('SucceesAddToPanier');
        modal.classList.add('added-to-cart');
    });

    // Ajout d'un écouteur d'événement pour le bouton de fermeture
    var closeButton = document.querySelector('#SucceesAddToPanier .close');
    closeButton.addEventListener('click', function() {
        // Vérifiez si la modale a la classe "added-to-cart"
        var modal = document.getElementById('SucceesAddToPanier');
        if (modal.classList.contains('added-to-cart')) {
            // Ne fermez pas la modale
            modal.classList.remove('added-to-cart');
        }
    });
</script>

<script>
    // Récupération du bouton "Ajouter au panier"
    var addToCartButton = document.getElementById('add-to-cart-button');

    // Ajout d'un écouteur d'événement sur le clic du bouton
    addToCartButton.addEventListener('click', function() {
        // Récupération de l'identifiant du produit
        var productId = '{{ product.Id_Produit }}'; // Assurez-vous que product.id correspond à l'identifiant du produit dans votre contexte Twig

        // Récupération de la quantité saisie dans le spinner
        var quantity = document.getElementById('quantity').value;
        var price = '{{ product.PrixP }}'
        // Envoi des données au contrôleur Symfony via une requête AJAX
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '{{ path("addToPanier") }}', true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                // Gestion de la réponse du serveur (optionnel)
                console.log('Produit ajouté au panier avec succès !');
            }
        };
        var data = JSON.stringify({
    productId: productId,
    quantity: quantity,
    price: price
});
        xhr.send(data);
    });
</script>


{% endblock %}


{% block javascripts %}
    {{ parent() }}

{% endblock %}
